<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title>EstadÃ­sticas</title>

</head>
<body>

<section layout:fragment="content">
    <div class="container mt-4">
        <h2>ðŸ“Š EstadÃ­sticas de los usuarios</h2>

        <div th:each="user : ${users}" th:if="${user.role != null and user.role != 'ADMIN'}" class="mt-4">
            <h4 th:text="${user.username+' - '+user.points}">Nombre Usuario</h4>
            <table class="table table-bordered table-hover">
                <thead class="table-dark">
                <tr>
                    <th>Fecha</th>
                    <th>Operation</th>
                    <th>Modo</th>
                    <th>Tabla</th>
                    <th>Total Preguntas</th>
                    <th>Correctas</th>
                    <th>% Aciertos</th>
                    <th>Promedio(Seg)</th>
                    <th>Puntos</th>
                </tr>
                </thead>
                <tbody th:each="result, statIndex : ${user.gameResults}">
                <tr th:data-bs-toggle="collapse"
                    th:data-bs-target="'#detailRow__' + ${statIndex.index}"
                    class="clickable-row"
                    style="cursor:pointer;">
                    <td th:text="${#temporals.format(result.playedAt, 'dd/MM/yyyy HH:mm')}"></td>
                    <td th:text="${result.operation}"></td>
                    <td th:text="${result.mode}"></td>
                    <td th:text="${result.tableName}"></td>
                    <td th:text="${result.totalQuestions}"></td>
                    <td th:text="${result.totalCorrect}"></td>
                    <td th:text="${result.percent + '%'}"></td>
                    <td th:text="${result.points}"></td>
                </tr>
                <!-- Row for collapsible detail -->
                <tr class="collapse" th:id="'detailRow__' + ${statIndex.index}">
                    <td colspan="8">
                        <table class="table table-hover table-sm mb-0">
                            <thead class="table-light">
                            <tr>
                                <th>#</th>
                                <th>Pregunta</th>
                                <th>Respuesta dada</th>
                                <th>Respuesta correcta</th>
                                <th>Â¿Correcto?</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="answer, iStat : ${result.answers}">
                                <td th:text="${iStat.index + 1}">1</td>
                                <td th:if="${result.operation != null and result.operation == 'MULTIPLICATION'}" th:text="${answer.a+' x '+answer.b}">7 x 3</td>
                                <td th:if="${result.operation != null and result.operation == 'ADDITION'}" th:text="${answer.a+' + '+answer.b}">7 + 3</td>
                                <td th:text="${answer.userAnswer}">21</td>
                                <td th:if="${result.operation != null and result.operation == 'MULTIPLICATION'}" th:text="${answer.a*answer.b}">21</td>
                                <td th:if="${result.operation != null and result.operation == 'ADDITION'}" th:text="${answer.a+answer.b}">21</td>
                                <td>
                                    <i th:if="${answer.correct}" class="fas fa-check text-success"></i>
                                    <span th:if="${!answer.correct}" class="fas fa-times text-danger"></span>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</section>

</body>
</html>

