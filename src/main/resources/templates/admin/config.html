<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title>Configuración</title>
</head>
<body>

<section layout:fragment="content">
    <div class="container">
        <h2>Configuración del Juego</h2>
        <form method="post" th:object="${config}">
            <div class="input-group">
                <span class="input-group-text">Tiempo por pregunta (segundos)</span>
                <input type="number"
                       aria-label="Tiempo por pregunta (segundos)"
                       class="form-control"
                       th:field="*{timeLimitSeconds}">
            </div>
            <div class="form-check mt-2">
                <input type="checkbox" class="form-check-input" th:field="*{enableTimer}"/>
                <label class="form-check-label">Activar cronómetro</label>
            </div>
            <div class="form-check mt-2">
                <input type="checkbox" class="form-check-input" th:field="*{enableAllTables}"/>
                <label class="form-check-label">Activar Todas las tablas</label>
            </div>
            <div class="input-group">
                <span class="input-group-text">Tabla Inicio</span>
                <input type="number"
                       aria-label="Tabla Inicio"
                       class="form-control"
                       th:field="*{rangeIni}">
            </div>
            <div class="input-group">
                <span class="input-group-text">Tabla Fin</span>
                <input type="number"
                       aria-label="Tabla Inicio"
                       class="form-control"
                       th:field="*{rangeFin}">
            </div>
            <input type="hidden" name="rangeTables" id="rangeTables" th:field="*{rangeTables}">
            <select id="sortFields" name="sortFields" size="12" class="form-select" multiple>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
                <option value="11">11</option>
                <option value="12">12</option>
            </select>

            <div class="input-group">
                <span class="input-group-text">Nro. Preguntas</span>
                <input type="number"
                       aria-label="Tabla Inicio"
                       class="form-control"
                       th:field="*{numberQuestions}">
            </div>
            <div class="input-group">
                <span class="input-group-text">Nro. Respuestas</span>
                <input type="number"
                       aria-label="Tabla Inicio"
                       class="form-control"
                       th:field="*{numberAnswers}">
            </div>
            <button class="btn btn-primary mt-3">Guardar</button>
        </form>
    </div>
    <script>
        function beforeSubmit() {
            const select = document.getElementById("sortFields");
            const hidden = document.getElementById("rangeTables");
            const selectedValues = Array.from(select.selectedOptions).map(option => option.value);
            hidden.value = selectedValues.join(",");
        }

        // Opcional: enganchar al evento submit de tu formulario
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.querySelector("form");
            if (form) {
                form.addEventListener("submit", function (event) {
                    beforeSubmit();
                });
            }
        });
        document.addEventListener("DOMContentLoaded", function () {
            const hiddenInput = document.getElementById("rangeTables");
            const select = document.getElementById("sortFields");

            if (hiddenInput && select && hiddenInput.value) {
                const selectedValues = hiddenInput.value.split(",");

                Array.from(select.options).forEach(option => {
                    if (selectedValues.includes(option.value)) {
                        option.selected = true;
                    }
                });
            }
        });
    </script>
</section>

</body>
</html>

